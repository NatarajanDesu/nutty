var globalObj,whichJQ;if(typeof TRM==="object"){globalObj=TRM;if(TRM.hasOwnProperty("$")&&TRM.$.fn){whichJQ=TRM.$}}else{globalObj=window;whichJQ=window.jQuery}(function($,window,document,undefined){"use strict";var DEBUG_MODE=false;var PLUGIN_NAME="jwvid";var VERSION="0.0.3";var modalCreated=false;var modalJwId;var remodalId=PLUGIN_NAME+"-modal";var jwEvents=["ready","playlist","playlistComplete","bufferChange","play","pause","buffer","complete","firstFrame","seek","time","fullscreen","beforePlay"];$[PLUGIN_NAME]={};var utils={loadCSSFile:function(path){var file=document.createElement("link");file.setAttribute("rel","stylesheet");file.setAttribute("type","text/css");file.setAttribute("href",path);document.getElementsByTagName("head")[0].appendChild(file)},findMyPath:function(){var script=$("script").filter(function(){return/jquery\.jwvid/.test(this.src)})[0];var path=script.src.substring(0,script.src.lastIndexOf("/"));return path},dashedToCamelCased:function(str){return str.replace(/-([a-zA-Z])/g,function(g){return g[1].toUpperCase()})},camelCasedToDashed:function(str){return str.replace(/([a-z][A-Z])/g,function(g){return g.split("").join("-").toLowerCase()})},coerceStringToBool:function(value){if(typeof value==="string"){if(value.toLowerCase()==="true"){value=true}else if(value.toLowerCase()==="false"){value=false}}return value},UUID:function(){function s(n){return h(Math.random()*(1<<(n<<2))^Date.now()).slice(-n)}function h(n){return(n|0).toString(16)}return[s(4)+s(4),s(4),"4"+s(3),h(8|Math.random()*4)+s(3),Date.now().toString(16).slice(-10)+s(2)].join("-")},log:function(){if(DEBUG_MODE&&typeof console==="object"&&typeof console.log==="function"){console.log.apply(console,$.merge(["["+PLUGIN_NAME+"]"],arguments))}},error:function(){if(typeof console==="object"){if(typeof console.error==="function"){console.error.apply(console,$.merge(["["+PLUGIN_NAME+"]"],arguments))}else{console.log.apply(console,$.merge(["["+PLUGIN_NAME+"]"],arguments))}}},cleanTitle:function(str){return str}};$.fn[PLUGIN_NAME]=function(options){if(typeof options!=="object"){options={}}var defaults={jwoptions:{aspectratio:"16:9",displaydescription:false,displaytitle:false,primary:"html5",width:"100%"},autoclose:true,autoOmniture:true,autostart:false,background:false,controls:true,ignorestop:false,licensekey:"sBEgJwnasNMgR9Ft2TEN75kPB2y2uyJ9cisiBA==",loopend:false,loopstart:false,modal:false,mute:false,omnitureTitle:false,omniturePrefix:false,playlistcontrol:false,repeat:false,skin:"seven",speed:false,stopothers:true,target:null,videokey:null};var getDataOverrides=function($el){var overrides={};for(var settingName in defaults){var attrName="data-"+PLUGIN_NAME+"-"+utils.camelCasedToDashed(settingName);var attrVal=$el.attr(attrName);if(attrVal){if(settingName==="jwoptions"){attrVal=JSON.parse(attrVal);utils.log("setting "+settingName+" to "+attrName+"("+attrVal+")");overrides[settingName]=$.extend(true,overrides[settingName],attrVal)}else{attrVal=utils.coerceStringToBool(attrVal);utils.log("setting "+settingName+" to "+attrName+"("+attrVal+")");overrides[settingName]=attrVal}}}return overrides};var requireSetting=function(settingName,settings){var retval=settings[settingName];if(typeof retval==="undefined"){throw new Error("["+PLUGIN_NAME+"] Missing "+settingName+" setting. Specify a data-"+PLUGIN_NAME+"-"+utils.camelCasedToDashed(settingName)+" attribute or set the "+settingName+" property in the settings.")}return retval};var jwplayers=[];var getOptions=function(id){return $(document.body).data(PLUGIN_NAME+"-settings")[id]||{}};var stopAllJWPlayersExcept=function(which){$.each(jwplayers,function(){if(this.hasOwnProperty("uniqueId")&&this.uniqueId!==which.uniqueId){var settings=getOptions(this.getContainer().id);if(!settings.ignorestop&&!settings.background){this.stop()}}})};var attachPlaylistControllers=function(playlistcontrol,targetId){$(playlistcontrol).each(function(){$(this).data("jwplayerId",targetId).on("click",function(){var $this=$(this);var jwplayerId=$this.data("jwplayerId");var item=$this.data(PLUGIN_NAME+"-item");jwplayer(jwplayerId).playlistItem(parseInt(item,10));return false})})};var jwSetup=function($el,jwplayer,targetId,settings){var videoKey=requireSetting("videokey",settings);var licenseKey=jwplayer.key||requireSetting("licensekey",settings);jwplayer.key=licenseKey;var jwdefaults={cookies:false,skin:settings.skin,key:licenseKey,playlist:"//content.jwplatform.com/feeds/"+videoKey+".rss"};var jwOptions=$.extend(jwdefaults,settings.jwoptions,{autostart:settings.autostart,controls:settings.controls,mute:settings.mute,repeat:settings.repeat});if(settings.background){jwOptions.autostart=true;jwOptions.controls=false;jwOptions.mute=true;jwOptions.stopothers=false;jwOptions.ignorestop=true;if(!(settings.loopstart&&settings.loopend)){jwOptions.repeat=true}}var jwp=jwplayer(targetId).setup(jwOptions);if(/MSIE 9/i.test(navigator.userAgent)){jwp.on("play",function(){this.getContainer().getElementsByTagName("video")[0].style.maxWidth="100%"})}if(typeof DynamicOmnitureTracking==="function"&&settings.autoOmniture){jwp.on("play",function(){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Play "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")}).on("pause",function(){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Pause "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")}).on("playlistComplete",function(){if(this.getPlaylist().length>1>1){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Complete "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")}}).on("complete",function(){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Complete "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")})}if(settings.playlistcontrol){attachPlaylistControllers(settings.playlistcontrol,targetId)}if(settings.stopothers&&!settings.background){jwp.on("play",function(){stopAllJWPlayersExcept(this)})}if(settings.speed&&!isNaN(parseFloat(settings.speed))){jwp.on("play",function(){this.getContainer().getElementsByTagName("video")[0].playbackRate=parseFloat(settings.speed)||1})}if(settings.loopstart&&settings.loopend){jwp.on("ready",function(){this.seek(settings.loopstart)}).on("time",function(event){if(event.position>=settings.loopend){this.seek(settings.loopstart)}})}for(var i=0,l=jwEvents.length;i<l;i++){jwp.on(jwEvents[i],function(event){$el.trigger("jwplayer:"+event.type,$.merge([this],arguments))})}jwplayers.push(jwp);$(document.body).data(PLUGIN_NAME+"-jwplayers")[targetId]=jwp};var openModal=function(){var $this=$(this);var settings=globalObj[PLUGIN_NAME].options(this.id);var videoKey=requireSetting("videokey",settings);var licenseKey=jwplayer.key||requireSetting("licensekey",settings);jwplayer.key=licenseKey;var jwdefaults={cookies:false,skin:settings.skin,key:licenseKey,playlist:"//content.jwplatform.com/feeds/"+videoKey+".rss"};var jwOptions=$.extend(jwdefaults,settings.jwoptions,{autostart:settings.autostart,controls:settings.controls,mute:settings.mute,repeat:settings.repeat});if(settings.background){jwOptions.autostart=true;jwOptions.controls=false;jwOptions.ignorestop=true;jwOptions.mute=true;jwOptions.stopothers=false;if(!(settings.loopstart&&settings.loopend)){jwOptions.repeat=true}}var doPlayer=function(targetId){var jwp=jwplayer(targetId).setup(jwOptions);$(jwp.getContainer()).data("modal",settings.modal);if(/MSIE 9/i.test(navigator.userAgent)){jwp.on("play",function(){this.getContainer().getElementsByTagName("video")[0].style.maxWidth="100%"})}if(typeof DynamicOmnitureTracking==="function"&&settings.autoOmniture){jwp.on("play",function(){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Play "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")}).on("pause",function(){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Pause "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")}).on("playlistComplete",function(){if(this.getPlaylist().length>1){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Complete "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")}}).on("complete",function(){var title=settings.omnitureTitle?settings.omnitureTitle:"Video Complete "+utils.cleanTitle(this.getPlaylistItem().title);if(settings.omniturePrefix){title=settings.omniturePrefix+" "+title}DynamicOmnitureTracking(title,"interaction")})}if(settings.playlistcontrol){attachPlaylistControllers(settings.playlistcontrol,targetId)}if(settings.stopothers&&!settings.background){jwp.on("play",function(){stopAllJWPlayersExcept(this)})}if(settings.speed&&!isNaN(parseFloat(settings.speed))){jwp.on("play",function(){this.getContainer().getElementsByTagName("video")[0].playbackRate=parseFloat(settings.speed)||1})}if(settings.loopstart&&settings.loopend){jwp.on("ready",function(){this.seek(settings.loopstart)}).on("time",function(event){if(event.position>=settings.loopend){this.seek(settings.loopstart)}})}if(settings.autoclose){jwp.on("playlistComplete",function(){var $container=$(this.getContainer());var modalType=$container.data("modal")||"remodal";if(modalType==="remodal"){$container.closest(".remodal").remodal().close()}else if(modalType==="reveal"){$container.closest(".reveal-modal").trigger("reveal:close")}})}for(var i=0,l=jwEvents.length;i<l;i++){jwp.on(jwEvents[i],function(event){$this.trigger("jwplayer:"+event.type,$.merge([this],arguments))})}};switch(settings.modal){case"remodal":case true:var modalInstance=$("[data-remodal-id="+remodalId+"]").remodal({hashTracking:false});modalInstance.open();doPlayer(modalJwId);$("[data-remodal-id="+remodalId+"]").on("closed",function(){var jwdiv=$(this).find(".jwplayer:first");if(jwdiv.length){var id=jwdiv.attr("id");if(id){jwplayer(id).remove()}}});break;case"reveal":default:break}};var modalSetup=function($el,jwplayer,settings){if(!modalCreated){modalJwId=PLUGIN_NAME+"-"+utils.UUID()}switch(settings.modal){case"remodal":case true:if(!modalCreated){$(document.body).append('<div data-remodal-id="'+remodalId+'"><a class="remodal-close" data-remodal-action="close"></a><div id="'+modalJwId+'">Loading the player...</div></div>');modalCreated=true}$el.on("click",openModal);break;default:break}};var launch=function($el,jwplayer,targetId,settings){if(settings.modal){modalSetup($el,jwplayer,settings)}else{jwSetup($el,jwplayer,targetId,settings)}};var init=function(el,settings){var $el=$(el);var targetId=settings.target;if(!targetId){targetId=$el.attr("id");if(!targetId){targetId=PLUGIN_NAME+"-"+utils.UUID();$el.attr("id",targetId)}}if(window.jwplayer){launch($el,jwplayer,targetId,settings)}else{utils.error("jwplayer must be loaded")}};$.data(document.body,PLUGIN_NAME+"-settings",{});$.data(document.body,PLUGIN_NAME+"-jwplayers",{});globalObj[PLUGIN_NAME]={version:VERSION,options:function(id){return $(document.body).data(PLUGIN_NAME+"-settings")[id]||{}},stopAll:function(){$.each(jwplayers,function(){this.stop()})},jwplayers:jwplayers};return this.each(function(){var $this=$(this);var settings=$.extend({},defaults,options||{});if((options.modal||$(this).data(PLUGIN_NAME+"-modal"))&&(!options.hasOwnProperty("autostart")&&!$this.data(PLUGIN_NAME+"-autostart"))){settings.autostart=true}settings=$.extend(true,{},settings,getDataOverrides($this));if(settings.background){settings.autoOmniture=false}init(this,settings);$(document.body).data(PLUGIN_NAME+"-settings")[this.id]=$.extend(true,{},settings)})}})(whichJQ,window,document);whichJQ(".jwvid").jwvid();
//# sourceMappingURL=jquery.jwvid-0.0.3.js.map
